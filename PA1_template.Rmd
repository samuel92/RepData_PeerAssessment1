---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r setoptions, echo=FALSE, results='asis'}
require(knitr)
opts_chunk$set(echo=TRUE)
```


```{r, echo=FALSE, results='hide'}
require(stats)
require(ggplot2)
require(dplyr)
Sys.setlocale("LC_TIME", "C")
```


## Loading and preprocessing the data
```{r}
MyData <- read.csv(unz("activity.zip", "activity.csv"), sep = ",", header = TRUE, strip.white = TRUE)
MyData$date<-as.Date(MyData$date)
MyData$weekday<-weekdays(MyData$date, abbreviate = FALSE)
```


## What is mean total number of steps taken per day?

```{r}
StepsByDay<-aggregate(steps~date, data=MyData, sum)
m <- ggplot(StepsByDay, aes(x=steps)) 
m + geom_histogram(aes(fill = ..count..), binwidth=1000) + ggtitle("total number of steps taken each day")

print (paste ("Mean of steps per day: ", round(mean(StepsByDay$steps),2)))
print (paste ("Median of steps per day: ", round(median(StepsByDay$steps),2)))

```


## What is the average daily activity pattern?

```{r}
AvgStepsByInterval<-aggregate(steps~interval, data=MyData, mean)
qplot(interval, steps, data=AvgStepsByInterval, geom="line") + ggtitle("average number of steps taken per interval, averaged across all days")

print (paste("The 5-minute interval containing the most steps: ", AvgStepsByInterval[AvgStepsByInterval$steps == max(AvgStepsByInterval$steps),]$interval))

```

## Imputing missing values

There are 8 entire days with missing values. Each day has 288 5-minute intervals. Then, 8*288 = 2304 rows with NAs.
I used the average number of steps for each interval accross all days.
This strategy impacts the number of days with average figures.

```{r}
print(paste("Number of rows with NA: ", sum(rowSums(is.na(MyData)))))
FilledData<-MyData
FilledData[is.na(MyData$steps),"steps"] <- rep(AvgStepsByInterval$steps, 8)

FilledStepsByDay<-aggregate(steps~date, data=FilledData, sum)
m <- ggplot(FilledStepsByDay, aes(x=steps)) 
m + geom_histogram(aes(fill = ..count..), binwidth=1000) + ggtitle("total number of steps taken each day")

```


## Are there differences in activity patterns between weekdays and weekends?

```{r}

FilledData<-mutate(FilledData, Week = factor(1 * (weekday %in% (c("Saturday", "Sunday"))), labels = c("Weekday", "weekend")))
FilledAvgStepsByInterval<-aggregate(steps~ interval + Week , data=FilledData, mean)

ggplot(FilledAvgStepsByInterval, aes(x=interval, y=steps, group=Week)) + geom_line() + facet_grid(Week~.) + ggtitle("average number of steps taken per interval, averaged across all days")

```

With the plot above, we can see the same pattern between weekday and weekend with slight differences. In particularly, steps are done sooner during the weekdays. 

